# ğŸ—ï¸ Architecture Diagrams

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT (Browser)                         â”‚
â”‚                      http://localhost:5173                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Whiteboard  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   React Flow Canvas            â”‚   â”‚
â”‚  â”‚   Component  â”‚         â”‚   â€¢ Grid, Pan, Zoom            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â€¢ 5 Node Types               â”‚   â”‚
â”‚         â”‚                  â”‚   â€¢ Connection Edges            â”‚   â”‚
â”‚         â”‚                  â”‚   â€¢ Mini Map, Controls          â”‚   â”‚
â”‚         â–¼                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚            Zustand Store (useWorkspaceStore)             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ State:                                                   â”‚   â”‚
â”‚  â”‚  â€¢ nodes[]       - Current nodes                        â”‚   â”‚
â”‚  â”‚  â€¢ edges[]       - Current edges                        â”‚   â”‚
â”‚  â”‚  â€¢ isDirty       - Unsaved flag                         â”‚   â”‚
â”‚  â”‚  â€¢ history[]     - Undo/redo (50 steps)                â”‚   â”‚
â”‚  â”‚ Actions:                                                â”‚   â”‚
â”‚  â”‚  â€¢ addNode, deleteNode, updateNode                      â”‚   â”‚
â”‚  â”‚  â€¢ addEdge, deleteEdge                                  â”‚   â”‚
â”‚  â”‚  â€¢ undo, redo                                           â”‚   â”‚
â”‚  â”‚  â€¢ save/load workspace                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                                        â”‚
â”‚         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Toolbar    â”‚                              â”‚
â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                              â”‚
â”‚                   â”‚ â€¢ Add Node   â”‚                              â”‚
â”‚                   â”‚ â€¢ Save/Load  â”‚                              â”‚
â”‚                   â”‚ â€¢ AI Suggest â”‚                              â”‚
â”‚                   â”‚ â€¢ Undo/Redo  â”‚                              â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                          â”‚                                       â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚         â”‚                â”‚                â”‚                     â”‚
â”‚         â–¼                â–¼                â–¼                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ API Call â”‚   â”‚  Dialog  â”‚   â”‚  Toast      â”‚               â”‚
â”‚   â”‚ (axios)  â”‚   â”‚ (Save,   â”‚   â”‚ (Notify)    â”‚               â”‚
â”‚   â”‚          â”‚   â”‚  Load)   â”‚   â”‚             â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚        â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP
         â”‚ JSON
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVER (Node.js/Express)                     â”‚
â”‚                    http://localhost:5050                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Express Server (index.ts)                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Middleware:                                              â”‚   â”‚
â”‚  â”‚  â€¢ Helmet (security headers)                            â”‚   â”‚
â”‚  â”‚  â€¢ CORS (cross-origin)                                  â”‚   â”‚
â”‚  â”‚  â€¢ Morgan (logging)                                     â”‚   â”‚
â”‚  â”‚  â€¢ authOptional (JWT parsing)                           â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚ Routes:                                                  â”‚   â”‚
â”‚  â”‚  â€¢ GET  /api/workspaces           - List                â”‚   â”‚
â”‚  â”‚  â€¢ POST /api/workspaces           - Create              â”‚   â”‚
â”‚  â”‚  â€¢ GET  /api/workspaces/:name     - Get                 â”‚   â”‚
â”‚  â”‚  â€¢ PUT  /api/workspaces/:name     - Update              â”‚   â”‚
â”‚  â”‚  â€¢ DEL  /api/workspaces/:name     - Delete              â”‚   â”‚
â”‚  â”‚  â€¢ POST /api/ai/suggest           - AI suggestions      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                                        â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚         â–¼                     â–¼                    â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Workspace  â”‚     â”‚ Validation   â”‚     â”‚  AI Router  â”‚     â”‚
â”‚  â”‚  Routes     â”‚     â”‚ Utils        â”‚     â”‚             â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚ â€¢ CRUD ops  â”‚     â”‚ â€¢ hasCycle   â”‚     â”‚ â€¢ OpenAI    â”‚     â”‚
â”‚  â”‚ â€¢ Validationâ”‚â”€â”€â”€â”€â–ºâ”‚ â€¢ countRoots â”‚â”€â”€â”€â”€â–ºâ”‚ â€¢ Heuristicsâ”‚     â”‚
â”‚  â”‚ â€¢ Owner     â”‚     â”‚ â€¢ Edge valid â”‚     â”‚             â”‚     â”‚
â”‚  â”‚   isolation â”‚     â”‚              â”‚     â”‚             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                                                        â”‚
â”‚         â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Workspace Model â”‚                      â”‚
â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
â”‚                       â”‚ Mongoose Schema: â”‚                      â”‚
â”‚                       â”‚  â€¢ name          â”‚                      â”‚
â”‚                       â”‚  â€¢ ownerId       â”‚                      â”‚
â”‚                       â”‚  â€¢ nodes[]       â”‚                      â”‚
â”‚                       â”‚  â€¢ edges[]       â”‚                      â”‚
â”‚                       â”‚  â€¢ timestamps    â”‚                      â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚ Query/Insert/Update
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   MongoDB Atlas         â”‚
                    â”‚  mongodb://...          â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ Database: whiteboard    â”‚
                    â”‚ Collection: workspaces  â”‚
                    â”‚                         â”‚
                    â”‚ Documents:              â”‚
                    â”‚ {_id, name, ownerId,    â”‚
                    â”‚  nodes[], edges[],      â”‚
                    â”‚  timestamps}            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Hierarchy

```
App
â”œâ”€â”€ Whiteboard
â”‚   â”œâ”€â”€ Toolbar
â”‚   â”‚   â”œâ”€â”€ Add Root Button
â”‚   â”‚   â”œâ”€â”€ Add Node Buttons (Frontend, Backend, Requirement, Doc)
â”‚   â”‚   â”œâ”€â”€ Save Button
â”‚   â”‚   â”‚   â””â”€â”€ Save Dialog Modal
â”‚   â”‚   â”œâ”€â”€ Load Button
â”‚   â”‚   â”‚   â””â”€â”€ Load Dialog Modal
â”‚   â”‚   â”œâ”€â”€ AI Suggest Button
â”‚   â”‚   â”œâ”€â”€ Undo/Redo Buttons
â”‚   â”‚   â””â”€â”€ Toast Notifications
â”‚   â””â”€â”€ ReactFlow Canvas
â”‚       â”œâ”€â”€ RootNode
â”‚       â”‚   â”œâ”€â”€ Badge
â”‚       â”‚   â”œâ”€â”€ Content (or Edit Mode)
â”‚       â”‚   â””â”€â”€ Handle (for connections)
â”‚       â”œâ”€â”€ FrontendNode
â”‚       â”‚   â”œâ”€â”€ Badge
â”‚       â”‚   â”œâ”€â”€ Content (or Edit Mode)
â”‚       â”‚   â””â”€â”€ Handle
â”‚       â”œâ”€â”€ BackendNode
â”‚       â”‚   â”œâ”€â”€ Badge
â”‚       â”‚   â”œâ”€â”€ Content (or Edit Mode)
â”‚       â”‚   â””â”€â”€ Handle
â”‚       â”œâ”€â”€ RequirementNode
â”‚       â”‚   â”œâ”€â”€ Badge
â”‚       â”‚   â”œâ”€â”€ Content (or Edit Mode)
â”‚       â”‚   â””â”€â”€ Handle
â”‚       â”œâ”€â”€ DocNode
â”‚       â”‚   â”œâ”€â”€ Badge
â”‚       â”‚   â”œâ”€â”€ Content (or Edit Mode)
â”‚       â”‚   â””â”€â”€ Handle
â”‚       â”œâ”€â”€ Edges (connections between nodes)
â”‚       â”œâ”€â”€ Background (grid)
â”‚       â”œâ”€â”€ Controls (zoom, fit)
â”‚       â””â”€â”€ MiniMap
```

---

## Data Flow: Save Workspace

```
User clicks "Save"
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Save Dialog Opens â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ User enters name
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validate Name     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Call: PUT /api/workspaces/:name   â”‚
â”‚ Body: {nodes[], edges[]}              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Axios with auth header
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Server Receives Request              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Auth       â”‚        â”‚  Validate Schema â”‚
    â”‚  Middleware â”‚        â”‚  (Zod)           â”‚
    â”‚  Parse JWT  â”‚        â”‚                  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                         â”‚
         â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Extract     â”‚        â”‚  Count Root Nodes  â”‚
    â”‚  ownerId     â”‚        â”‚  (must be 1)       â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                          â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                         â”‚            â”‚
         â–¼                         â–¼            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Filter  â”‚        â”‚  DFS Cycle      â”‚  â”‚ Validate â”‚
    â”‚  by Ownerâ”‚        â”‚  Detection      â”‚  â”‚ Node     â”‚
    â”‚          â”‚        â”‚                 â”‚  â”‚ Types    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼ All validations pass?
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  YES: Continue  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  MongoDB Update:     â”‚
              â”‚  findOneAndUpdate    â”‚
              â”‚  {name, ownerId}     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Update Successful    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼ Send back updated document
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Client receives 200 â”‚
              â”‚  Response JSON       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Store.markClean()   â”‚
              â”‚  Close Modal         â”‚
              â”‚  Show Toast Success  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

              If validation fails:
                       â”‚
                       â–¼ (at any step above)
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Return 400/409      â”‚
              â”‚  Error Message       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Client receives err â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Show Toast Error    â”‚
              â”‚  Stay in Dialog      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: Load Workspace

```
User clicks "Load"
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ List Dialog Opens    â”‚
â”‚ API: GET /api/...    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Server filters by ownerId
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Returns workspace    â”‚
â”‚ list                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Display in dialog
User selects workspace
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API: GET /api/workspaces/:name
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Server validates owner
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Returns workspace JSON   â”‚
â”‚ {nodes[], edges[]}       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ store.loadWorkspace()    â”‚
â”‚ Replace state with data  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ React Flow re-renders    â”‚
â”‚ Canvas updates           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Close Dialog             â”‚
â”‚ Show Toast Success       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Schema Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Workspaces Collection                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚ Document {                                                     â”‚
â”‚   _id: ObjectId,                                               â”‚
â”‚   name: "My SPA Project",                                      â”‚
â”‚   ownerId: "user123" | null,                                   â”‚
â”‚                                                                 â”‚
â”‚   nodes: [                                                     â”‚
â”‚     {                                                          â”‚
â”‚       id: "root-1",                                            â”‚
â”‚       type: "root",                                            â”‚
â”‚       position: { x: 0, y: 0 },                                â”‚
â”‚       data: {                                                  â”‚
â”‚         title: "SPA Monorepo",                                 â”‚
â”‚         summary: "Full-stack React + Node app",               â”‚
â”‚         stackHint: "React, Node.js, MongoDB"                   â”‚
â”‚       }                                                        â”‚
â”‚     },                                                         â”‚
â”‚     {                                                          â”‚
â”‚       id: "frontend-1",                                        â”‚
â”‚       type: "frontend",                                        â”‚
â”‚       position: { x: -200, y: 100 },                           â”‚
â”‚       data: {                                                  â”‚
â”‚         title: "Web UI",                                       â”‚
â”‚         summary: "React components",                           â”‚
â”‚         stackHint: "React 18, Vite"                            â”‚
â”‚       }                                                        â”‚
â”‚     },                                                         â”‚
â”‚     {                                                          â”‚
â”‚       id: "backend-1",                                         â”‚
â”‚       type: "backend",                                         â”‚
â”‚       position: { x: 200, y: 100 },                            â”‚
â”‚       data: {                                                  â”‚
â”‚         title: "REST API",                                     â”‚
â”‚         summary: "Express server",                             â”‚
â”‚         stackHint: "Node.js, Express"                          â”‚
â”‚       }                                                        â”‚
â”‚     },                                                         â”‚
â”‚     ...                                                        â”‚
â”‚   ],                                                           â”‚
â”‚                                                                 â”‚
â”‚   edges: [                                                     â”‚
â”‚     {                                                          â”‚
â”‚       id: "edge-1",                                            â”‚
â”‚       source: "root-1",                                        â”‚
â”‚       target: "frontend-1"                                     â”‚
â”‚     },                                                         â”‚
â”‚     {                                                          â”‚
â”‚       id: "edge-2",                                            â”‚
â”‚       source: "root-1",                                        â”‚
â”‚       target: "backend-1"                                      â”‚
â”‚     },                                                         â”‚
â”‚     ...                                                        â”‚
â”‚   ],                                                           â”‚
â”‚                                                                 â”‚
â”‚   createdAt: "2025-01-15T10:30:00Z",                           â”‚
â”‚   updatedAt: "2025-01-15T12:45:00Z"                            â”‚
â”‚ }                                                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Machine: Workspace States

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   NEW/EMPTY     â”‚ â† User creates/loads workspace
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   EDITING       â”‚ â† User modifies nodes/edges
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ isDirty = true
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UNSAVED       â”‚ â† Waiting for save
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ User clicks Save
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SAVING        â”‚ â† API in flight
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ Success? Yes â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                  â”‚   SAVED      â”‚ â† isDirty = false
         â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â””â”€ Failure â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚
                              â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   ERROR      â”‚ â† Show toast, stay in UNSAVED
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Validation Flow

```
Client-Side Validation
(Instant)
â”‚
â”œâ”€ Only 1 root node?
â”œâ”€ No cycles? (DFS check)
â”œâ”€ Valid node types?
â”œâ”€ Valid positions?
â”‚
â””â”€ Block if fails
   (No API call)

    â”‚
    â–¼

Server-Side Validation
(On save/update)
â”‚
â”œâ”€ Zod schema check
â”œâ”€ Only 1 root node?
â”œâ”€ No cycles? (DFS check)
â”œâ”€ Valid node types?
â”œâ”€ Owner match?
â”œâ”€ MongoDB unique constraint
â”‚
â””â”€ Reject with 400/409 if fails
   (Return error message)

    â”‚
    â–¼

Data Persisted
(Success)
```

---

This framework is production-ready and fully visualized! ğŸ‰
